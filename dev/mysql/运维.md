## 日志

### 错误日志

```sql
-- 查看相关配置
SHOW VARIABLES LIKE "%log_error%";
```

![image-20240722173202132](https://raw.githubusercontent.com/timothy020/pic/main/img/image-20240722173202132.png)

### 二进制日志

记录**DDL**和**DML**语句

```sql
-- 查看相关配置
SHOW VARIABLES LIKE "%log_bin%";

-- 查看日志格式
SHOW VARIABLES LIKE "%binlog_format";
```

![image-20240722174922438](https://raw.githubusercontent.com/timothy020/pic/main/img/image-20240722174922438.png)

| 日志格式  | 含义                                                         |
| --------- | ------------------------------------------------------------ |
| STATEMENT | 基于SQL语句的日志记录，记录的是SQL语句，对数据进行修改的SQL都会记录在日志文件中。 |
| ROW       | 基于行的日志记录，记录的是每一行的数据变更。（默认）         |
| MIXED     | 混合了STATEMENT和ROW两种格式，默认采用STATEMENT，在某些特殊情况下会自动切换为ROW进行记录。 |

```shell
mysqlbinlog [参数选项] logfilename

-d : 指定数据库名称，只列出指定的数据库相关操作。
-o : 忽略掉日志中的前n行命令
-v : 将行事件（数据变更）重构为SQL语句
-vv : 将行事件（数据变更）重构为SQL语句，并输出注释信息
```

清理二进制日志

```sql
-- 删除全部binlog日志，删除之后，日志编号，将从 binlog.000001重新开始
reset master;

-- 删除******编号之前的所有日志
purge master logs to 'binlog.***';

-- 删除日志为"y-mm-dd hh24:mi:ss"之前产生的所有日志
purge master logs before 'yyyy-mm-dd hh24:mi:ss';

-- 配置过期时间
SHOW VARIABLES LIKE '%binlog_expire_logs_seconds%';
```

### 查询日志

```sql
-- 查看相关配置
SHOW VARIABLES LIKE "%general%";
```

### 慢查询日志

```sql
-- 慢查询日志
slow_query_log=1

-- 执行时间参数
long_query_time=2

-- 记录执行较慢的管理语句
log_slow_admin_statements =1

-- 记录执行较慢的未使用索引的语句
log_queries_not_using_indexes = 1
```





