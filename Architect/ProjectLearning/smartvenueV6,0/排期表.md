## 排期

| 功能                    | 截止日期 | 完成情况                        | 备注         |
| ----------------------- | -------- | ------------------------------- | ------------ |
| 管理端登录              | 1.5      | √                               |              |
| 地面端登录              | 1.5      | √                               | 具体业务未知 |
| 用户端登录              | 1.23     | √                               |              |
| 营业点管理              | 1.24     | 待测试                          |              |
| 预定规则管理            | 1.26     | 待测试                          |              |
| 预定规则设置            | 2.4      | 待测试                          |              |
| 现场开单-显示多项信息   | 2.18     | 待联调                          |              |
| 现场开单-交互信息查询   | 2.18     | 待联调                          |              |
| 现场开单-锁场与场次详情 | 2.20     | 待联调                          |              |
| 会员信息管理            | 2.29     | 是否需要获取openId?<br />待自测 |              |

**工作量清单：**

![image-20240120185025464](https://raw.githubusercontent.com/timothy020/pic/main/img/image-20240120185025464.png)

![image-20240120185121898](https://raw.githubusercontent.com/timothy020/pic/main/img/image-20240120185121898.png)

![image-20240120185135726](https://raw.githubusercontent.com/timothy020/pic/main/img/image-20240120185135726.png)

![image-20240222111947512](https://raw.githubusercontent.com/timothy020/pic/main/img/image-20240222111947512.png)



```sql
CREATE TABLE lntd_sv_field_lock (
    id BIGINT NOT NULL PRIMARY KEY AUTO_INCREMENT COMMENT "主键id",
    session_id Long NOT NULL COMMENT "锁定的场次的id",
    reason varchar(50) NOT NULL COMMENT "锁场原因",
    type tinyint NOT NULL COMMENT "锁场类型,1-因维修而锁场;2-闭馆锁场;3-其他原因;4-解锁",

    tenant_id 	BIGINT 	NOT NULL	COMMENT "租户id",
    deleted 	BIT 	NOT NULL 	DEFAULT 0  COMMENT "删除标志，0-未删除，1-删除，默认为0",
    creator 	BIGINT	NOT NULL  	COMMENT "创建者",
    create_time DATETIME 	NOT NULL  	COMMENT "创建时间",
    updater 	BIGINT 	NOT NULL	COMMENT "更新者",
    update_time DATETIME NOT NULL	COMMENT "更新时间" 
)COMMENT="锁场表";
```

更新营业点debug: 前端没传入nickname

```json
{
    "id":1,
    "name": "测试营业点1",
    "venueId": 1,
    "zoneId":"1,2",
    "photo": "https://miaopsbucket.oss-cn-beijing.aliyuncs.com/smartvenues6.0.1/site1.webp",
    "shiftInfo": [
      {
        "userId": 146,
        "userNickname": "地面端管理员01",
        "startTime": "08:00",
        "endTime": "20:00"
      },
      {
          "userId": 1, 
          "startTime": "06:15",
          "endTime": "06:00"
      }
    ],
    "available": true,
    "mobile": true
}
```



## 需求梳理

移动端登录(23)->卡规则设置(26)->“我的”首页(28)->

普通会员管理(30)->会员卡办理/会员信息管理(4)->好物列表，卡详情等(6)

->核销，共享人设置等(9)



管理端：

| 模块           | 预计工期 | 备注                         |
| -------------- | -------- | ---------------------------- |
| 卡规则管理     | 1+0.5    | 卡规则管理                   |
| 卡规则设置接口 | 1+0.5    | 设置卡规则                   |
| 卡产品定义     | 2+1      | 三类卡种的CRDT以及下拉框接口 |



营业端：

| 需求                       | 预计工期 | 备注                                                         |
| -------------------------- | -------- | ------------------------------------------------------------ |
| 会员卡办理                 | 2+1      | 显示营业点可办理的卡；条件查询；关联卡与卡规则信息<br />会员办理：支付，【关联卡与会员到订单表与权益表，添加会员到会员/散客表】(支付回调) |
| 支付成功页面<br />会员开卡 | 1.5+0.5  | 设置共享人，核销密码，三类卡信息与规则详情                   |

用户端：

| 需求                         | 预计工期 | 备注                                                 |
| ---------------------------- | -------- | ---------------------------------------------------- |
| 好物<br />会员卡详情(购买前) | 1+0.5    | 查询会员卡信息，权益与购卡协议                       |
| 会员卡详情(购买后)           | 1+0.5    | 共享人设置，核销密码设置，查询核销记录，查看购卡协议 |











管理端：10

| 需求           | 预计工期      | 备注                                                         |
| -------------- | ------------- | ------------------------------------------------------------ |
| 用户登录与注销 | 2 + 0.5(联调) | 1. session与token<br />2. 租户管理<br />3. **用户表**有变动吗【用ruoyi的】 |
| 营业点管理     | 2.5 + 1(联调) | 什么是营业点【场馆-营业点-场区，有管理人员】<br />1. 营业点增删改查页面，【所有的营业点】<br />2. 人员相关接口：营业点添加人员，减少人员，设置管理员等等。【在设置排班的时候设置】<br />3. **用户-营业点表[user-BusinessPlace-admin-tenantId]**,updateTime,updateUser?<br />4. 所属场馆：营业点所属的场馆还是用户所属的场馆，管理员才有编辑权限，**用户-场馆表** <br />5. 图片上传接口【后端有公共接口】<br />6. 班次信息的存储结构，一个字段？三个字段？【班次表】<br />营业点编号 班次编号 管理员编号 起止时间 updatetime… |
| 预订规则管理   | 2.5           | json，如何解析                                               |
| 预订规则设置   | 1.5           | 如何将规则反作用到代码里 【不涉及规则的使用】                |

地面端：16

| 需求                                 | 预计工期        | 备注                                                         |
| ------------------------------------ | --------------- | ------------------------------------------------------------ |
| 用户登录与注销                       | 1 + 0.5(联调)   | 登录时就需要验证值班信息                                     |
| 开单主页面：基本信息查询             | 2               | 左上角基本信息：**用户-营业点表**、**值班表**如何定义，如何验证是否为值班人员【比较班次即可】<br />场区卡片信息： 运动类型平均单场人数；已结束订单数；剩余场地数：（**场区-场地表**），**定时任务**<br /> |
| 开单主页面：动态信息展示             | 2.5 + 2(联调)   | 最近办理记录：交易记录存放在订单表中吗；【看看订单和日志】如何更新：前端**更新**还是**websocket**实现更新【前端同步或者websocket都可以】<br />场次与价格：（**场地-场次表**），场次信息如何与分级价格对应【json数据类型】，场次状态从哪里获取【数据字典】，数据如何有效返回[场次对象的关键信息，场次id]<br />sql优化，何时请求 |
| 锁场                                 | 1               | 场次id -> 场次状态                                           |
| 场次状态详情页面                     | 1 + 0.5（联调） | 场次预定与随机预定【随机预定头尾要占住，取交集】             |
| 会员信息管理：基本信息与权益         | 2               | 查询用的用户id从何处获取【右侧点击详情】；图片上传接口<br />会员删除按钮<br />卡权益：卡产品信息表中的商户id是否就是用户id【权益先不写】<br />其他权益需要查询什么信息 |
| 会员信息管理：订单明细查询与现场支付 | 2.5 + 1（联调） | 支付方式与如何实现【调用公共接口】                           |

用户端：3

| 需求           | 预计工期 | 备注 |
| -------------- | -------- | ---- |
| 用户登录与注销 | 2 + 1    |      |



关于用户标识：

- username唯一：获取租户id的依据

- usercode唯一

- nickname不唯一： 

  **在营业点管理排班部分用作查询【假设唯一，因为用username来设置排班表对用户不直观，且一般不会出现同名】**

![image-20240125121805191](https://raw.githubusercontent.com/timothy020/pic/main/img/image-20240125121805191.png)

![image-20240125121829821](https://raw.githubusercontent.com/timothy020/pic/main/img/image-20240125121829821.png)